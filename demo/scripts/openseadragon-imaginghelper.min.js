//! OpenSeadragonImagingHelper 1.0.0
//! Build date: 2013-11-06
//! Git commit: f3003b4-dirty
//! https://github.com/msalsbery/OpenSeadragonImagingHelper
!function(a){a.Viewer.prototype.activateImagingHelper=function(b){return this.imagingHelper||(b=b||{},b.viewer=this,this.imagingHelper=new a.ImagingHelper(b)),this.imagingHelper},a.ImagingHelper=function(b){if(b=b||{},!b.viewer)throw new Error("A viewer must be specified.");b.viewer.imagingHelper||(b.viewer.imagingHelper=this),this.options=b,this.imgWidth=0,this.imgHeight=0,this.imgAspectRatio=0,this._zoomFactor=1,this._minZoom=.001,this._maxZoom=10,this._zoomStepPercent=30,this._viewer=b.viewer,this._haveImage=!1,this._viewportWidth=0,this._viewportHeight=0,this._viewportOrigin=new OpenSeadragon.Point(0,0),this._viewportCenter=new OpenSeadragon.Point(0,0),a.EventSource.call(this),b.viewChangedHandler&&this.addHandler("image-view-changed",b.viewChangedHandler),this._viewer.addHandler("open",a.delegate(this,this.onOpen)),this._viewer.addHandler("close",a.delegate(this,this.onClose)),this._viewer.addHandler("animation",a.delegate(this,this.onAnimation)),this._viewer.addHandler("animation-finish",a.delegate(this,this.onAnimationFinish)),this._viewer.addHandler("fullpage",a.delegate(this,this.onFullPage))},a.extend(a.ImagingHelper.prototype,a.EventSource.prototype,{getMinZoom:function(){return this._minZoom},setMinZoom:function(a){this._minZoom=a,this._viewer.minZoomLevel=a*this.imgWidth/this._viewer.viewport.getContainerSize().x},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(a){this._maxZoom=a,this._viewer.maxZoomLevel=a*this.imgWidth/this._viewer.viewport.getContainerSize().x},getZoomStepPercent:function(){return this._zoomStepPercent},setZoomStepPercent:function(a){this._zoomStepPercent=a},setView:function(a,b,c,d){this._haveImage&&((this._viewportWidth!=a||this._viewportHeight!=b)&&this._viewer.viewport.zoomTo(1/a,null,d),(this._viewportCenter.x!=c.x||this._viewportCenter.y!=c.y)&&this._viewer.viewport.panTo(new OpenSeadragon.Point(c.x,c.y/this.imgAspectRatio),d))},getZoomFactor:function(){return this._zoomFactor},setZoomFactor:function(a,b){this._haveImage&&a!=this._zoomFactor&&a>0&&this._viewer.viewport.zoomTo(a*this.imgWidth/this._viewer.viewport.getContainerSize().x,new OpenSeadragon.Point(this._viewportCenter.x,this._viewportCenter.y/this.imgAspectRatio),b)},zoomIn:function(a){var b=this._zoomFactor;b*=1+this._zoomStepPercent/100,b>this._maxZoom&&(b=this._maxZoom),this.setZoomFactor(b,a)},zoomOut:function(a){var b=this._zoomFactor;b*=1-this._zoomStepPercent/100,b<this._minZoom&&(b=this._minZoom),this.setZoomFactor(b,a)},zoomAboutLogicalPoint:function(a,b,c){this._haveImage&&a!=this._zoomFactor&&a>0&&this._viewer.viewport.zoomTo(a*this.imgWidth/this._viewer.viewport.getContainerSize().x,new OpenSeadragon.Point(b.x,b.y/this.imgAspectRatio),c)},zoomInAboutLogicalPoint:function(a,b){var c=this._zoomFactor;c*=1+this._zoomStepPercent/100,c>this._maxZoom&&(c=this._maxZoom),this.zoomAboutLogicalPoint(c,a,b)},zoomOutAboutLogicalPoint:function(a,b){var c=this._zoomFactor;c*=1-this._zoomStepPercent/100,c<this._minZoom&&(c=this._minZoom),this.zoomAboutLogicalPoint(c,a,b)},centerAboutLogicalPoint:function(a,b){(this._haveImage&&this._viewportCenter.x!=a.x||this._viewportCenter.y!=a.y)&&this._viewer.viewport.panTo(new OpenSeadragon.Point(a.x,a.y/this.imgAspectRatio),b)},physicalToLogicalPoint:function(a){return new OpenSeadragon.Point(this.physicalToLogicalX(a.x),this.physicalToLogicalY(a.y))},logicalToPhysicalPoint:function(a){return new OpenSeadragon.Point(this.logicalToPhysicalX(a.x),this.logicalToPhysicalY(a.y))},physicalToLogicalX:function(a){return this._haveImage?this._viewportOrigin.x+a/this._viewer.viewport.getContainerSize().x*this._viewportWidth:0},physicalToLogicalY:function(a){return this._haveImage?this._viewportOrigin.y+a/this._viewer.viewport.getContainerSize().y*this._viewportHeight:0},logicalToPhysicalX:function(a){return this._haveImage?(a-this._viewportOrigin.x)/this._viewportWidth*this._viewer.viewport.getContainerSize().x:0},logicalToPhysicalY:function(a){return this._haveImage?(a-this._viewportOrigin.y)/this._viewportHeight*this._viewer.viewport.getContainerSize().y:0},physicalToLogicalDistance:function(a){return this._haveImage?a/this._viewer.viewport.getContainerSize().x*this._viewportWidth:0},logicalToPhysicalDistance:function(a){return this._haveImage?a/this._viewportWidth*this._viewer.viewport.getContainerSize().x:0},logicalToDataPoint:function(a){return new OpenSeadragon.Point(this.logicalToDataX(a.x),this.logicalToDataY(a.y))},dataToLogicalPoint:function(a){return new OpenSeadragon.Point(this.dataToLogicalX(a.x),this.dataToLogicalY(a.y))},physicalToDataPoint:function(a){return new OpenSeadragon.Point(this.physicalToDataX(a.x),this.physicalToDataY(a.y))},dataToPhysicalPoint:function(a){return new OpenSeadragon.Point(this.dataToPhysicalX(a.x),this.dataToPhysicalY(a.y))},logicalToDataX:function(a){return this._haveImage?a*this.imgWidth:0},logicalToDataY:function(a){return this._haveImage?a*this.imgHeight:0},dataToLogicalX:function(a){return this._haveImage&&this.imgWidth>0?a/this.imgWidth:0},dataToLogicalY:function(a){return this._haveImage&&this.imgHeight>0?a/this.imgHeight:0},physicalToDataX:function(a){return this._haveImage&&this._viewer.viewport.getContainerSize().x>0?(this._viewportOrigin.x+a/this._viewer.viewport.getContainerSize().x*this._viewportWidth)*this.imgWidth:0},physicalToDataY:function(a){return this._haveImage&&this._viewer.viewport.getContainerSize().y>0?(this._viewportOrigin.y+a/this._viewer.viewport.getContainerSize().y*this._viewportHeight)*this.imgHeight:0},dataToPhysicalX:function(a){return this._haveImage&&this.imgWidth>0?(a/this.imgWidth-this._viewportOrigin.x)/this._viewportWidth*this._viewer.viewport.getContainerSize().x:0},dataToPhysicalY:function(a){return this._haveImage&&this.imgHeight>0?(a/this.imgHeight-this._viewportOrigin.y)/this._viewportHeight*this._viewer.viewport.getContainerSize().y:0},trackZoomPan:function(){var a=this._viewer.viewport.getBounds(!0);this._viewportOrigin.x=a.x,this._viewportOrigin.y=a.y*this.imgAspectRatio,this._viewportWidth=a.width,this._viewportHeight=a.height*this.imgAspectRatio,this._viewportCenter.x=this._viewportOrigin.x+this._viewportWidth/2,this._viewportCenter.y=this._viewportOrigin.y+this._viewportHeight/2,this._zoomFactor=this._viewer.viewport.getContainerSize().x/(this._viewportWidth*this.imgWidth),this.raiseEvent("image-view-changed",{viewportWidth:this._viewportWidth,viewportHeight:this._viewportHeight,viewportOrigin:this._viewportOrigin,viewportCenter:this._viewportCenter,zoomFactor:this._zoomFactor})},onOpen:function(){this._haveImage=!0,this.imgWidth=this._viewer.viewport.contentSize.x,this.imgHeight=this._viewer.viewport.contentSize.y,this.imgAspectRatio=this.imgWidth/this.imgHeight,this.trackZoomPan()},onClose:function(){this._haveImage=!1,this.imgWidth=0,this.imgHeight=0,this.imgAspectRatio=0},onAnimation:function(){this.trackZoomPan()},onAnimationFinish:function(){this.trackZoomPan()},onFullPage:function(){this.trackZoomPan()}})}(OpenSeadragon);